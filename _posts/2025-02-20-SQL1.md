---
title: SQL - Introduction
description: Programming language
categories: [Course,SQL]
tags: [note]
math: true
date: 2025-02-20   19:56:00 -0500
# image:
#   path:
media_subpath: /assets/media
---
# Introduction of SQL

## What is SQL?

* SQL是一种用来管理和操作关系型数据库的编程语言。与非关系型数据库（比如Python中的字典）不同，SQL专门用于关系型数据库管理系统（RDBMS），如MySQL、PostgreSQL和Oracle等。这些数据库可以存储大量以表格形式组织的数据
* Structured Query Language (vs. No-SQL e.g. dictionary in Python)
* Can access multiple databases
* What can SQL do?

  * Pull data from tables (SELECT)

    * **提取数据** ：使用`SELECT`命令从一个或多个表中检索数据。
  * Update data in the table (UPDATE/INSERT)

    * **更新数据** ：使用`UPDATE`命令修改表中的现有数据，使用`INSERT`命令向表中添加新数据。
  * Delete data/table (DROP/DELETE)

    * **删除数据或表格** ：使用`DELETE`命令删除表中的数据，使用`DROP`命令删除整个表。
  * Create a new table to store data (CREATE)

    * **创建新表** ：使用`CREATE`命令来定义新表，用来存储数据。
* SQL basis? - RDBMS (Relational Database Management System)

  * **RDBMS（关系型数据库管理系统）** ：这是一个服务或软件，用于创建、管理和查询关系数据库。数据库中可以包含多个表，每个表都有多条记录。表中的数据通常以行和列的形式组织，每行代表一条记录，每列代表一个数据字段。
* A database can have multiple tables, one table can have multiple records.
* ![Graph](RDBMS.png)
* 关系型数据库的特点：

  * 表之间的关系：在RDBMS中，数据以表格的形式存储，表格之间可以通过
  * 键字（例如，客户ID）建立关系，实现数据间的连接。这就是所谓的一对多的关系，例如一个客户可以有多个订单。
  * 数据完整性和精确性：通过定义外键、约束和索引来保证数据的完整性。这对于保证数据库中的数据准确无误非常重要。
  * 事务处理：RDBMS支持事务处理，这意味着你可以执行一系列操作，要么全部完成，要么全部不做，保证数据库的一致性。
* NoSQL数据库的特点：

  * 灵活的数据模型：NoSQL不需要预先定义数据模型，非常适合需要存储不规则或不断变化数据结构的应用。
  * 可扩展性：NoSQL数据库通常更容易水平扩展，这意味着它们可以通过增加更多的服务器来处理更多的数据，而不是升级现有服务器。
* ![Graph](NoSQLvsRDBMS.png)
* 关系数据库管理系统（RDBMS）和NoSQL数据库在处理数据关联方式上确实存在明显差异：

  * RDBMS：在关系型数据库中，数据是通过表来组织的，表之间通过外键约束建立联系，支持复杂的联接操作（JOINs）。这种结构非常适合处理那些需要严格数据完整性和复杂关系的应用场景。
  * NoSQL：相比之下，NoSQL数据库通常不支持传统的表间联接操作。它们侧重于灵活性和扩展性，适合于处理结构不固定或者不需要严格事务性的大数据应用。NoSQL数据库中，数据间的联系通常需要在应用层通过程序代码来管理和实现，而不是通过数据库的内置功能。

## How SQL execute

#### SQL 执行逻辑

![Graph](SQLfunction.png)
当执行SQL查询时，查询的处理顺序如下：

1. **FROM 子句**：
   - 确定需要从哪些表中检索数据，包括解析表名和可能的JOIN操作。
2. **WHERE 子句**：
   - 应用WHERE子句的过滤条件来缩小结果集，只返回符合特定条件的行。
3. **GROUP BY 子句**：
   - 如果查询中包含GROUP BY，则对数据进行分组，通常用于准备聚合函数（如COUNT、MAX、MIN等）的计算。
4. **HAVING 子句**：
   - HAVING允许对GROUP BY生成的分组结果进行过滤，它在GROUP BY之后执行，只能用于筛选聚合后的结果。
5. **SELECT 子句**：
   - 确定了哪些行会被返回后，SELECT子句指定返回这些行的哪些列。在这一步可以进行计算或修改返回的数据。
6. **ORDER BY 子句**：
   - 对最终的结果集进行排序。如果没有指定排序方向，默认为升序排序。
7. **LIMIT 子句**：
   - 用于限制返回的记录数，减少网络传输或页面渲染的负载。

### SQL 注释

- 使用注释可以帮助开发者理解SQL语句的目的，尤其是在复杂的查询中。
- 注释可以使用双破折号（`--`）开始，直到行尾，或者使用`/*`和`*/`包裹一段注释。

### 示例解析

![Graph](RDBMS.png)

```sql
-- Retrieve countries from region 1
SELECT country_id, country_name
FROM countries
WHERE region_id = 1
ORDER BY country_name;
```

> 这个查询的目的是检索region_id为1的所有国家，并按国家名称进行排序。从执行逻辑来看，首先从countries表中选取数据，应用WHERE子句过滤，最后对结果进行排序并返回country_id和country_name。

## 练习

### 创建表和插入数据

```sql
-- 创建employees表，包含id, employee_name, dept, salary字段
CREATE TABLE employees(id INT, employee_name VARCHAR(50), dept VARCHAR(30), salary INT);

-- 插入数据到employees表
INSERT INTO employees VALUES(1, "John", "IT", 5000);
INSERT INTO employees VALUES(2, "Mary", "Finance", 8000);
-- 更多数据插入...
```

> 目的：建立一个名为employees的表，用来存储员工的ID、姓名、部门和薪资，并向表中添加具体的员工数据。

### 检索数据

```sql
-- 查询employees表中所有数据
SELECT * FROM employees;

-- 查询IT部门的所有员工信息
SELECT * FROM employees WHERE dept='IT';

-- 查询薪资超过5000的所有员工
SELECT * FROM employees WHERE salary>5000;

-- 查询销售部门且薪资超过5000的员工
SELECT * FROM employees WHERE dept='Sales' AND salary>5000;

-- 查询销售部门或薪资超过5000的员工
SELECT * FROM employees WHERE dept='Sales' OR salary>5000;

-- 仅查询IT部门员工的姓名和薪资
SELECT employee_name, salary FROM employees WHERE dept='IT';

-- 查询非IT部门的所有员工
SELECT * FROM employees WHERE dept<>'IT';

-- 查询姓名中包含"an"的所有员工
SELECT * FROM employees WHERE UPPER(employee_name) LIKE '%AN%';
```

> 目的：展示如何使用不同的条件来过滤和选择数据库中的数据。这包括基于部门、薪资以及姓名的过滤。

### 聚合和排序

```sql
-- 按部门计算总薪资
SELECT dept, SUM(salary) AS total_salary FROM employees GROUP BY dept;

-- 查询每个部门最高薪资超过5000的部门及其最高薪资
SELECT dept, MAX(salary) AS max_salary FROM employees GROUP BY dept HAVING MAX(salary) > 5000;

-- 按员工姓名降序排序所有员工信息
SELECT * FROM employees ORDER BY employee_name DESC;

-- 查询薪资最高的前三名员工
SELECT * FROM employees ORDER BY salary DESC LIMIT 3;
```

> 目的：演示如何使用聚合函数（如SUM, MAX）进行数据汇总，以及如何使用ORDER BY和LIMIT子句对结果进行排序和限制。
